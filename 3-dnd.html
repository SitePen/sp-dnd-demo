<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- Copyright (c) 2008 SitePen, Inc. All Rights Reserved -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>dojo.dnd :: Demo 0.3</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<script type="text/javascript" src="/js/sm-iepng.js" defer="defer" charset="ISO-8859-1"></script>

<style type="text/css">
	@import url("http://o.aolcdn.com/dojo/1.1.1/dojo/resources/dojo.css");
	@import url("http://o.aolcdn.com/dojo/1.1.1/dojo/resources/dnd.css");
	@import url("http://o.aolcdn.com/dojo/1.1.1/dijit/themes/tundra/tundra.css");
	@import url("site-3.css");
	@import url("dnd.css");
</style>
<script type="text/javascript" src="http://o.aolcdn.com/dojo/1.1.1/dojo/dojo.xd.js"></script>
<script type="text/javascript">
	dojo.require("dojo.dnd.Source");
	dojo.require("dijit.TitlePane");

	// create the DOM representation for the given item
	function catalogNodeCreator(item, hint) {
		// create a table/tr/td-based node structure; each item here needs an
		// image, a name, a brief description, and a quantity available
		var tr = document.createElement("tr");
		var imgTd = document.createElement("td");
		var nameTd = document.createElement("td");
		var qtyTd = document.createElement("td");

		var img = document.createElement("img");
		img.src = "images/" + (item.image || "_blank.gif");
		dojo.addClass(imgTd, "itemImg");
		imgTd.appendChild(img);

		nameTd.appendChild(document.createTextNode(item.name || "Product"));
		if (item.description && hint != "avatar"){
			var descSpan = document.createElement("span");
			descSpan.innerHTML = item.description;
			nameTd.appendChild(document.createElement("br"));
			nameTd.appendChild(descSpan);
		}
		dojo.addClass(nameTd, "itemText");

		tr.appendChild(imgTd);
		tr.appendChild(nameTd);

		if (hint != "avatar") {
			qtyTd.innerHTML = item.quantity;
			dojo.addClass(qtyTd, "itemQty");
			tr.appendChild(qtyTd);
		}else{
			// put the avatar into a self-contained table
			var table = document.createElement("table");
			var tbody = document.createElement("tbody");
			tbody.appendChild(tr);
			table.appendChild(tbody);
			node = table;
		}

		var type = item.quantity ? ["inStock"] : ["outOfStock"];

		return {node: tr, data: item, type: type};
	};

	// create a dojo.dnd.Source from the data provided
	function buildCatalog(node, data) {
		var dndObj = new dojo.dnd.Source(node, {copyOnly: true, creator: catalogNodeCreator});
		dndObj.insertNodes(false, data);
		dndObj.forInItems(function(item, id, map){
			dojo.addClass(id, item.type[0]);
		});
		return dndObj;
	};

	function init() {
		var junkCatalog = buildCatalog("junkCatalogNode", [
			{ name: "Wrist watch", image: "watch.jpg", description: "Tell time with Swiss precision", quantity: 3 },
			{ name: "Life jacket", image: "life-jacket.jpg", description: "Stay afloat during your frequent shipwrecks", quantity: 1 },
			{ name: "Toy bulldozer", image: "bulldozer.jpg", description: "Move the earth, one cup at a time", quantity: 8 },
			{ name: "Vintage microphone", image: "microphone.jpg", description: "Make 'em swoon in your blue suede shoes", quantity: 0 },
			{ name: "TIE fighter", image: "tie-fighter.jpg", description: "Rid your neighborhood of pesky Rebel Scum", quantity: 0 }
		]);

		var foodCatalog = buildCatalog("foodCatalogNode", [
			{ name: "Apples", image: "apple.jpg", description: "Keep the doctor away on a daily basis", quantity: 10 },
			{ name: "Bananas", image: "bananas.jpg", description: "Bananas are an excellent source of potassium", quantity: 18 },
			{ name: "Tomatoes", image: "tomatoes.jpg", description: "Imported fresh daily from Dylan's front porch", quantity: 0 },
			{ name: "Bread", image: "bread.jpg", description: "Guaranteed to be either stale or fresh", quantity: 7 }
		]);

		var cartPane = new dijit.TitlePane({title: "Shopping Cart", open: false}, "cartPaneNode");
		var wishlistPane = new dijit.TitlePane({title: "Wishlist", open: false}, "wishlistPaneNode");

		var cart = new dojo.dnd.Target("cartPaneNode", {accept: ["inStock"]});
		cart.parent = dojo.query("#cartNode tbody")[0];
		var wishlist = new dojo.dnd.Target("wishlistPaneNode", {accept: ["inStock","outOfStock"]});
		wishlist.parent = dojo.query("#wishlistNode tbody")[0];
	};
	dojo.addOnLoad(init);
</script>
</head>
<body id="demo3" class="tundra">
<h1>dojo.dnd :: Demo 0.3</h1>

<div id="store">
	<div id="wishListAndCart">
		<div id="cartPaneNode">
			<table id="cartNode"><tbody></tbody></table>
		</div>
		<div id="wishlistPaneNode">
			<table id="wishlistNode"><tbody></tbody></table>
		</div>
	</div>

	<div class="catalogContainer">
		<h2>Products</h2>
		<table id="junkCatalogNode">
			<thead>
				<tr>
					<th></th>
					<th>Junk</th>
					<th>Qty</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
		<table id="foodCatalogNode">
			<thead>
				<tr>
					<th></th>
					<th>Food</th>
					<th>Qty</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
	</div>

	<p class="instructions"><b>Instructions:</b> Drag products from the Catalog into either the Cart or Wishlist.</p>

	<p class="details"><b>Notes:</b></p>
	<ul>
		<li>This is step 3 in the SitePen blog's <a href="http://www.sitepen.com/blog/?p=358">Intro to Dojo DnD</a>.</li>
		<li>The Wishlist accepts anything in the store; the Cart only accepts items marked as in stock.</li>
		<li>Standard multiple selection works here. Beware; you can only drop a group if every item can be dropped into the list you're attempting to drop them on!</li>
		<li>Breakthrough at the lab! It's possible to clone products! (hint: drag an item into the list in which it already lives)</li>
	</ul>
</div>

<div id="footer"><a id="sitepen" href="http://www.sitepen.com/"><img src="images/sitepen150.png" alt="SitePen, Inc. logo" sm:iepng="true"/></a> &copy; 2008 SitePen, Inc. All Rights Reserved.</div>
</body>
</html>
